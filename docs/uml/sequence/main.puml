@startuml
skinparam ParticipantPadding 20
skinparam BoxPadding 10

actor 用户
participant App
participant GameViewer
participant GameRenderer
participant EventParser
participant "PIXI.js" as PIXI
participant GSAP

box "初始化阶段" #LightBlue
    用户 -> App: 访问系统
    activate App
    
    App -> EventParser: 获取解析器实例
    activate EventParser
    
    App -> EventParser: 解析比赛数据
    EventParser --> App: 返回事件列表
    deactivate EventParser
    
    App -> GameViewer: 创建游戏视图
    activate GameViewer
    
    GameViewer -> GameRenderer: 创建渲染器
    activate GameRenderer
    
    GameRenderer -> PIXI: 初始化画布
    activate PIXI
    PIXI --> GameRenderer: 返回渲染容器
    
    GameRenderer -> PIXI: 创建场景元素
    PIXI --> GameRenderer: 返回场景对象
    deactivate PIXI
    
    GameRenderer --> GameViewer: 渲染器就绪
    deactivate GameRenderer
    
    GameViewer --> App: 视图就绪
    deactivate GameViewer
    
    App --> 用户: 显示初始界面
    deactivate App
end box

box "播放控制" #LightYellow
    用户 -> App: 点击播放
    activate App
    
    App -> GameViewer: 开始播放
    activate GameViewer
    
    loop 每个事件
        GameViewer -> GameRenderer: 播放事件
        activate GameRenderer
        
        GameRenderer -> GSAP: 创建动画
        activate GSAP
        
        GameRenderer -> PIXI: 更新场景
        activate PIXI
        PIXI --> GameRenderer: 渲染更新
        deactivate PIXI
        
        GSAP --> GameRenderer: 动画完成
        deactivate GSAP
        
        GameRenderer --> GameViewer: 事件播放完成
        deactivate GameRenderer
        
        GameViewer -> App: 更新状态
        App -> App: 更新统计数据
    end
    
    GameViewer --> App: 播放完成
    deactivate GameViewer
    
    App --> 用户: 更新界面
    deactivate App
end box

box "交互控制" #LightGreen
    用户 -> App: 交互操作
    activate App
    
    alt 暂停
        App -> GameViewer: 暂停播放
        GameViewer -> GameRenderer: 停止动画
        GameRenderer -> GSAP: 暂停所有动画
        
    else 调速
        App -> GameViewer: 设置速度
        GameViewer -> GameRenderer: 更新动画速度
        GameRenderer -> GSAP: 调整时间缩放
        
    else 跳转
        App -> GameViewer: 跳转到指定事件
        GameViewer -> GameRenderer: 重置场景
        GameRenderer -> GSAP: 清除动画
        GameRenderer -> PIXI: 重置位置
    end
    
    App --> 用户: 响应完成
    deactivate App
end box

@enduml 